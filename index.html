<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jija Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        :root { --primary: #D81B60; --dark: #1e293b; --light: #f8fafc; --white: #ffffff; }
        body { font-family: 'Poppins', sans-serif; margin: 0; background: var(--light); padding-bottom: 80px; }
        
        header { background: var(--primary); padding: 15px; display: flex; justify-content: space-between; align-items: center; color: white; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .cart-btn { background: white; color: var(--primary); padding: 8px 15px; border-radius: 20px; font-weight: 600; border: none; cursor: pointer; }

        /* VIDEO BANNERS */
        .cat-grid { display: flex; gap: 10px; padding: 15px; overflow-x: auto; scrollbar-width: none; }
        .cat-card { min-width: 110px; height: 110px; border-radius: 12px; overflow: hidden; position: relative; cursor: pointer; flex-shrink: 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .cat-media { width: 100%; height: 100%; object-fit: cover; }
        .cat-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.9rem; text-align: center; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; padding: 15px; max-width: 1200px; margin: 0 auto; }
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; cursor: pointer; }
        .badge-img { position: absolute; top: 10px; left: 10px; width: 40px; height: auto; z-index: 10; }
        .card img.main-img { width: 100%; height: 200px; object-fit: cover; }
        .info { padding: 10px; }
        .title { font-size: 0.9rem; margin: 0 0 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .price { font-weight: 700; font-size: 1.1rem; }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center; }
        .modal-box { background: white; width: 90%; max-width: 500px; height: 90vh; border-radius: 15px; overflow-y: auto; position: relative; }
        
        .section-title { font-size: 1rem; font-weight: 600; margin: 20px 15px 10px; padding-bottom: 5px; border-bottom: 2px solid #eee; }
        .similar-row { display: flex; gap: 10px; overflow-x: auto; padding: 0 15px 15px; }
        .sim-card { min-width: 120px; background: #f8fafc; border-radius: 8px; padding: 5px; cursor: pointer; }
        .sim-card img { width: 100%; height: 120px; object-fit: cover; border-radius: 6px; }
        
        .review-box { padding: 0 15px 20px; }
        .review-item { background: #f8fafc; padding: 10px; border-radius: 8px; margin-bottom: 10px; }
        .star-row { color: #f59e0b; font-size: 0.9rem; }
        
        .btn-full { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; font-weight: 600; font-size: 1rem; cursor: pointer; position: sticky; bottom: 0; }
        
        /* SLIDER */
        .hero-slider { height: 240px; margin: 10px 20px; border-radius: 16px; overflow: hidden; position: relative; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: none; }
        .slide { position: absolute; inset: 0; opacity: 0; transition: 0.5s; }
        .slide.active { opacity: 1; }
        .slide img { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body>

    <header>
        <div style="display:flex; align-items:center; gap:10px; font-weight:700; font-size:1.2rem;">
            <img src="logo.jpg" style="height:35px; border-radius:50%;" onerror="this.style.display='none'"> Jija Studio
        </div>
        <button class="cart-btn" onclick="openCart()">Cart <span id="cCount">0</span></button>
    </header>

    <div class="cat-grid" id="catBanners"></div>

    <div class="grid" id="grid"></div>

    <div id="productView" class="modal">
        <div class="modal-box">
            <div style="position:absolute; top:15px; right:15px; background:rgba(255,255,255,0.8); border-radius:50%; width:30px; height:30px; display:flex; align-items:center; justify-content:center; cursor:pointer;" onclick="document.getElementById('productView').style.display='none'">&times;</div>
            <img id="pvImg" style="width:100%; height:350px; object-fit:contain; background:#f9f9f9;">
            <div id="pvVideoBox" style="display:none; padding:10px;"><iframe id="pvVideo" width="100%" height="200" frameborder="0"></iframe></div>
            
            <div style="padding:15px;">
                <h2 id="pvTitle" style="margin:0 0 5px;"></h2>
                <div style="font-size:1.2rem; font-weight:700; color:var(--primary);"><span id="pvPrice"></span></div>
                <select id="pvSize" style="width:100%; padding:10px; margin-top:10px; border:1px solid #ddd; border-radius:6px;"></select>
                <div id="pvStock" style="font-size:0.85rem; margin-top:5px; font-weight:600;"></div>
                <p id="pvDesc" style="color:#666; font-size:0.9rem; line-height:1.5;"></p>
            </div>

            <div class="section-title">You Might Also Like</div>
            <div class="similar-row" id="similarRow"></div>

            <div class="section-title">Customer Reviews</div>
            <div class="review-box">
                <div id="reviewList"></div>
                <div style="margin-top:15px; border-top:1px dashed #ccc; padding-top:10px;">
                    <input id="revText" placeholder="Write a review..." style="width:100%; padding:8px; margin-bottom:5px;">
                    <select id="revRate" style="padding:5px;">
                        <option value="5">★★★★★</option>
                        <option value="4">★★★★☆</option>
                    </select>
                    <button onclick="addReview()" style="background:#333; color:white; border:none; padding:5px 15px; border-radius:4px; cursor:pointer;">Post</button>
                </div>
            </div>

            <button class="btn-full" onclick="addToCart()">ADD TO CART</button>
        </div>
    </div>

    <div id="cartModal" class="modal">
        <div class="modal-box" style="padding:20px; height:auto;">
            <h3 style="margin-top:0;">Your Cart</h3>
            <div id="cartList"></div>
            <button class="btn-full" style="margin-top:20px;" onclick="placeOrder()">CHECKOUT ON WHATSAPP</button>
            <button onclick="document.getElementById('cartModal').style.display='none'" style="width:100%; padding:10px; background:transparent; border:none; color:#666; margin-top:5px;">Close</button>
        </div>
    </div>

    <div id="heroSlider" class="hero-slider"></div>

    <script>
        const DB_URL = "https://jija-studio-default-rtdb.firebaseio.com/jijaData.json";
        const ADMIN_PHONE = "918830903621";
        let appData = { products: [], reviews: [], catBanners: [] };
        let cart = [], curProd = null;
        let user = JSON.parse(localStorage.getItem('jijaUser')) || { name: "Guest" };

        window.onload = async () => {
            const r = await fetch(DB_URL);
            const d = await r.json();
            if(d) {
                appData = d;
                if(!appData.products) appData.products=[];
                if(!appData.reviews) appData.reviews=[];
                if(!appData.catBanners) appData.catBanners=[];
                renderHome();
                initSlider();
            }
        };

        function renderHome() {
            // Render Cat Banners (Video/Img)
            document.getElementById('catBanners').innerHTML = appData.catBanners.map(b => {
                const media = b.type === 'vid' 
                    ? `<video src="${b.media}" class="cat-media" autoplay muted loop playsinline></video>`
                    : `<img src="${b.media}" class="cat-media">`;
                
                return `<div class="cat-card" onclick="filterBySub('${b.sub}')">
                    ${media}
                    <div class="cat-overlay">${b.sub}</div>
                </div>`;
            }).join('');

            // Render Products
            document.getElementById('grid').innerHTML = appData.products.map(p => `
                <div class="card" onclick="openProd(${p.id})">
                    ${p.badge ? `<img src="${p.badge}" class="badge-img">` : ''}
                    <img src="${p.img}" class="main-img">
                    <div class="info">
                        <div class="title">${p.name}</div>
                        <div class="price">₹${p.price}</div>
                    </div>
                </div>
            `).join('');
        }

        function initSlider() {
            const slider = document.getElementById('heroSlider');
            const banners = appData.products.filter(p => p.isBanner);
            if(banners.length) {
                slider.style.display = 'block';
                slider.innerHTML = banners.map((p,i) => `<div class="slide ${i===0?'active':''}" style="opacity:${i===0?1:0}"><img src="${p.img}" onclick="openProd(${p.id})"></div>`).join('');
                let idx=0;
                setInterval(() => {
                    const s = slider.querySelectorAll('.slide');
                    s[idx].style.opacity=0; idx=(idx+1)%s.length; s[idx].style.opacity=1;
                }, 4000);
            } else slider.style.display='none';
        }

        function filterBySub(sub) {
            const filtered = appData.products.filter(p => p.subCats && p.subCats.includes(sub));
            document.getElementById('grid').innerHTML = filtered.map(p => `
                <div class="card" onclick="openProd(${p.id})">
                    <img src="${p.img}" class="main-img">
                    <div class="info"><div class="title">${p.name}</div><div class="price">₹${p.price}</div></div>
                </div>
            `).join('');
        }

        function openProd(id) {
            curProd = appData.products.find(p => p.id === id);
            
            document.getElementById('pvImg').src = curProd.img;
            document.getElementById('pvTitle').innerText = curProd.name;
            document.getElementById('pvPrice').innerText = '₹' + curProd.price;
            document.getElementById('pvDesc').innerText = curProd.desc || "";
            
            const vBox = document.getElementById('pvVideoBox');
            if(curProd.video && curProd.video.includes('embed')) {
                vBox.style.display = 'block';
                document.getElementById('pvVideo').src = curProd.video;
            } else vBox.style.display = 'none';

            const sel = document.getElementById('pvSize');
            sel.innerHTML = '<option value="">Select Size</option>';
            for(let [s, q] of Object.entries(curProd.stock)) {
                if(q > 0) sel.innerHTML += `<option value="${s}">Size ${s}</option>`;
            }

            // SIMILAR PRODUCTS
            const sims = appData.products.filter(p => p.cat === curProd.cat && p.id !== curProd.id).slice(0, 5);
            document.getElementById('similarRow').innerHTML = sims.map(p => 
                `<div class="sim-card" onclick="openProd(${p.id})">
                    <img src="${p.img}">
                    <div style="font-size:0.8rem; font-weight:600;">₹${p.price}</div>
                </div>`
            ).join('');

            renderReviews();
            document.getElementById('productView').style.display = 'flex';
        }

        function renderReviews() {
            const revs = appData.reviews.filter(r => r.pid === curProd.id);
            const list = document.getElementById('reviewList');
            if(revs.length === 0) list.innerHTML = "<div style='color:#999; font-size:0.9rem;'>No reviews yet. Be the first!</div>";
            else {
                list.innerHTML = revs.map(r => 
                    `<div class="review-item">
                        <div style="font-weight:600; font-size:0.85rem;">${r.user} <span class="star-row">${"★".repeat(r.rating)}</span></div>
                        <div style="font-size:0.9rem; color:#555;">${r.text}</div>
                    </div>`
                ).join('');
            }
        }

        async function addReview() {
            const txt = document.getElementById('revText').value;
            const rate = document.getElementById('revRate').value;
            if(!txt) return alert("Write something!");
            
            appData.reviews.push({ pid: curProd.id, user: user.name, text: txt, rating: parseInt(rate), date: new Date().toISOString() });
            await fetch(DB_URL, { method: "PUT", body: JSON.stringify(appData) });
            document.getElementById('revText').value = "";
            renderReviews();
        }

        function addToCart() {
            const sz = document.getElementById('pvSize').value;
            if(!sz) return alert("Select Size");
            cart.push({...curProd, size:sz, qty:1});
            document.getElementById('productView').style.display='none';
            alert("Added!");
        }

        function openCart() {
            const list = document.getElementById('cartList');
            list.innerHTML = cart.map(i => `<div style="display:flex; gap:10px; margin-bottom:10px;"><img src="${i.img}" style="width:50px; height:50px; object-fit:cover;"><div><b>${i.name}</b><br>${i.size} | ₹${i.price}</div></div>`).join('');
            document.getElementById('cartModal').style.display='flex';
        }

        function placeOrder() {
            if(cart.length===0) return;
            let msg = `New Order from ${user.name}:\n`;
            cart.forEach(i => msg += `${i.name} (${i.size}) x1\n`);
            window.open(`https://wa.me/${ADMIN_PHONE}?text=${encodeURIComponent(msg)}`);
        }
    </script>
</body>
</html>
