<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jija Admin | Professional Dashboard</title>
    <style>
        :root { --primary: #D81B60; --dark: #2c3e50; --edit: #f39c12; --green: #27ae60; --light: #f4f7f6; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; background: var(--light); display: flex; color: #333; }
        
        /* LAYOUT */
        .sidebar { width: 260px; background: var(--dark); color: white; min-height: 100vh; padding: 25px; position: fixed; box-sizing: border-box; }
        .main-content { margin-left: 260px; padding: 40px; width: 100%; box-sizing: border-box; }
        
        /* UI ELEMENTS */
        h1, h2, h3 { margin-top: 0; }
        .card { background: white; padding: 25px; margin-bottom: 25px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 1px solid #e0e0e0; }
        
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .full-width { grid-column: span 2; }
        
        label { font-weight: 600; font-size: 0.9rem; color: #555; display: block; margin-bottom: 5px; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 0.95rem; transition: border 0.3s; }
        input:focus, select:focus, textarea:focus { border-color: var(--primary); outline: none; }
        
        button { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 0.95rem; transition: opacity 0.2s; }
        button:hover { opacity: 0.9; }
        
        /* STOCK GRID */
        .stock-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 10px; margin-top: 10px; }
        .stock-item { background: #fafafa; padding: 8px; border: 1px solid #eee; text-align: center; border-radius: 6px; }
        .stock-item label { font-size: 0.75rem; margin-bottom: 2px; }
        .stock-item input { padding: 5px; text-align: center; font-weight: bold; }

        /* TABLE */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; background: #f8f9fa; padding: 12px; border-bottom: 2px solid #eee; font-size: 0.9rem; color: #666; }
        td { padding: 12px; border-bottom: 1px solid #eee; vertical-align: middle; }
        .img-preview { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd; }
        
        /* BADGES */
        .badge { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; margin-right: 3px; margin-bottom: 3px; }
        .badge-stock { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }
        .badge-zero { background: #ffebee; color: #c62828; border: 1px solid #ffcdd2; }
        .badge-banner { background: var(--green); color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.7rem; text-transform: uppercase; }

        /* BUTTONS */
        .btn-edit { background: var(--edit); padding: 6px 12px; font-size: 0.85rem; margin-right: 5px; }
        .btn-del { background: #e74c3c; padding: 6px 12px; font-size: 0.85rem; }
        .edit-active { border: 2px solid var(--edit); background: #fffcf5; }

        /* OVERLAYS */
        #adminLogin, #loadingOverlay { position: fixed; inset: 0; background: #2c3e50; display: flex; align-items: center; justify-content: center; z-index: 9999; }
        #loadingOverlay { background: rgba(255,255,255,0.9); color: var(--primary); font-size: 1.5rem; font-weight: bold; display: none; }
    </style>
</head>
<body>

<div id="loadingOverlay">Syncing with Cloud...</div>

<div id="adminLogin">
    <div style="background:white; padding:40px; border-radius:10px; width:320px; text-align:center; box-shadow:0 10px 25px rgba(0,0,0,0.2);">
        <h2 style="color:var(--primary); margin-bottom:20px;">Jija Admin</h2>
        <input id="adminUser" placeholder="Username" style="margin-bottom:15px;">
        <input id="adminPass" type="password" placeholder="Password" style="margin-bottom:20px;">
        <button onclick="checkAdminLogin()" style="width:100%;">Secure Login</button>
        <p id="loginErr" style="color:red; font-size:13px; margin-top:15px;"></p>
    </div>
</div>

<div class="sidebar">
    <h2 style="border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:15px;">Jija Studio</h2>
    <p style="font-size:13px; opacity:0.7;">Inventory Management</p>
    <a href="#" style="color:white; text-decoration:none; display:block; padding:10px 0; font-weight:500;">Dashboard</a>
    <button onclick="clearAllData()" style="background:#c0392b; width:100%; margin-top:50px; font-size:13px;">‚ö† Reset Database</button>
</div>

<div class="main-content">
    
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h1>Dashboard</h1>
        <select id="themeSelect" onchange="saveTheme()" style="width:200px;">
            <option value="default">üå∏ Theme: Default (Pink)</option>
            <option value="diwali">üéÜ Theme: Diwali (Orange)</option>
            <option value="christmas">üéÑ Theme: Christmas (Green)</option>
        </select>
    </div>

    <div class="card">
        <h3>üìÇ Category Management</h3>
        <div style="background: #f8f9fa; padding:15px; border-radius:6px;">
            <div class="form-grid">
                <div>
                    <label>Main Category</label>
                    <select id="manageCatSelect" onchange="renderManageSubCats()">
                        <option value="cloth">Adult Fashion</option>
                        <option value="kids">Kids Wear</option>
                        <option value="footwear">Footwear</option>
                        <option value="jewelry">Jewelry</option>
                        <option value="toy">Toy</option>
                    </select>
                </div>
                <div>
                    <label>Add Sub-Category</label>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="newSubCat" placeholder="e.g. Kaftan">
                        <button onclick="addSubCategory()" style="width:auto;">Add</button>
                    </div>
                </div>
            </div>
            <div style="margin-top:15px;">
                <label>Active Sub-Categories:</label>
                <div id="manageSubCatList" style="display:flex; gap:5px; flex-wrap:wrap; margin-top:5px;"></div>
            </div>
        </div>
    </div>

    <div class="card" id="productFormCard">
        <h3 id="formTitle">‚ûï Add New Product</h3>
        <div class="form-grid">
            <div><label>Product Name</label><input type="text" id="pName"></div>
            <div>
                <label>Category</label>
                <select id="pCat" onchange="toggleCategoryLogic()">
                    <option value="cloth">Adult Fashion</option>
                    <option value="kids">Kids Wear</option>
                    <option value="footwear">Footwear</option>
                    <option value="jewelry">Jewelry</option>
                    <option value="toy">Toy</option>
                </select>
            </div>
            
            <div class="full-width" style="background: #fff8e1; padding: 20px; border-radius: 6px; border: 1px solid #ffe082;">
                <label style="color:#f57f17; font-size:1rem; margin-bottom:10px;">üí∞ Pricing</label>
                <div class="form-grid">
                    <div><label>MRP (‚Çπ)</label><input type="number" id="pMRP" placeholder="2000"></div>
                    <div><label>Selling Price (‚Çπ)</label><input type="number" id="pPrice" placeholder="1500"></div>
                </div>
            </div>

            <div><label>Sub-Category</label><select id="pSubCat" onchange="renderStockInputs()"><option value="">Select...</option></select></div>
            
            <div class="full-width" style="background: #f0f4f8; padding: 20px; border-radius: 6px;">
                <label style="color:#2c3e50; font-size:1rem; margin-bottom:10px;">üì∏ Media Links</label>
                <div class="form-grid">
                    <div><label>Main Image URL</label><input type="text" id="pImg" placeholder="https://..."></div>
                    <div><label>Image 2 URL</label><input type="text" id="pImg2"></div>
                    <div><label>Image 3 URL</label><input type="text" id="pImg3"></div>
                    <div><label>Video URL</label><input type="text" id="pVideo"></div>
                </div>
            </div>

            <div class="full-width"><label>Description</label><textarea id="pDesc" rows="3"></textarea></div>
        </div>

        <div style="margin-top:20px; background:#f9f9f9; padding:10px; border-radius:5px; display:flex; align-items:center; gap:10px;">
            <input type="checkbox" id="pBanner" style="width:20px; height:20px;">
            <label for="pBanner" style="margin:0; cursor:pointer;">Promote in Home Page Slider</label>
        </div>

        <div id="stockSection" style="margin-top: 20px; padding: 20px; background: #e8f6f3; border: 1px dashed #27ae60; border-radius: 6px; display:none;">
            <label style="color:#27ae60; font-size:1rem;">üì¶ Inventory Stock</label>
            <div id="stockContainer" class="stock-grid"></div>
        </div>
        <div id="simpleStockOption" style="display:none; margin-top:20px; padding: 20px; background: #e8f6f3; border: 1px dashed #27ae60; border-radius: 6px;">
            <label style="color:#27ae60; font-size:1rem;">üì¶ Total Stock Quantity</label> 
            <input type="number" id="pSimpleStock" value="10" style="width:100px; margin-top:5px;">
        </div>

        <div style="margin-top: 30px; display:flex; gap:10px;">
            <button id="submitBtn" onclick="handleFormSubmit()" style="flex:1;">Save Product to Cloud</button>
            <button id="cancelEditBtn" onclick="exitEditMode()" style="background:#7f8c8d; display:none;">Cancel</button>
        </div>
    </div>

    <div class="card">
        <h3>üì¶ Live Inventory</h3>
        <table>
            <thead><tr><th>Image</th><th>Details</th><th>Price</th><th>Stock Status</th><th>Actions</th></tr></thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<script>
    // --- CONFIGURATION ---
    const DB_URL = "https://jija-studio-default-rtdb.firebaseio.com/jijaData.json"; // üëà Your Real Database URL
    const ADMIN_USER = "admin";      
    const ADMIN_PASS = "12345";      

    // --- STATE ---
    let appData = { 
        products: [], 
        subCategories: { 
            cloth: ["Saree", "Suits"], 
            kids: ["Boys", "Girls"], 
            footwear: ["Shoes", "Sandals"], 
            jewelry: ["Necklace", "Bangles"], 
            toy: ["Cars"] 
        } 
    };
    let editingId = null;

    // --- SIZES CONSTANTS ---
    const ADULT_SIZES = ["S", "M", "L", "XL", "XXL", "3XL", "4XL", "5XL", "6XL", "Free Size"];
    const KIDS_SIZES = ["0-1Y", "1-2Y", "2-3Y", "3-4Y", "4-5Y", "5-6Y", "6-7Y", "7-8Y", "8-9Y", "9-10Y", "11-12Y", "13-14Y"];
    const BANGLE_SIZES = ["2-2", "2-4", "2-6", "2-8", "2-10"];
    const FOOTWEAR_SIZES = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13];

    // --- INITIALIZATION ---
    window.onload = function() {
        if (sessionStorage.getItem('adminLogged') === 'yes') {
            document.getElementById('adminLogin').style.display = 'none';
            loadFromCloud();
        }
        const savedTheme = localStorage.getItem('jijaTheme');
        if(savedTheme) document.getElementById('themeSelect').value = savedTheme;
    };

    function checkAdminLogin() {
        const u = document.getElementById('adminUser').value;
        const p = document.getElementById('adminPass').value;
        if (u === ADMIN_USER && p === ADMIN_PASS) {
            sessionStorage.setItem('adminLogged', 'yes');
            document.getElementById('adminLogin').style.display = 'none';
            loadFromCloud();
        } else {
            document.getElementById('loginErr').innerText = "Incorrect username or password.";
        }
    }

    // --- CLOUD FUNCTIONS ---
    function loadFromCloud() {
        document.getElementById('loadingOverlay').style.display = 'flex';
        fetch(DB_URL)
            .then(r => r.json())
            .then(data => {
                if (data) {
                    appData = data;
                    if(Array.isArray(appData.subCategories)) { // Fix potential array issue
                        appData.subCategories = { cloth: appData.subCategories, kids: ["Boys"], footwear: ["Shoes"], jewelry: ["Necklace"], toy: ["Cars"] };
                    }
                }
                refreshUI();
                document.getElementById('loadingOverlay').style.display = 'none';
            })
            .catch(err => {
                console.error(err);
                alert("Failed to load data from Cloud.");
                document.getElementById('loadingOverlay').style.display = 'none';
            });
    }

    function saveToCloud() {
        document.getElementById('loadingOverlay').style.display = 'flex';
        fetch(DB_URL, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(appData)
        })
        .then(() => {
            document.getElementById('loadingOverlay').style.display = 'none';
            alert("‚úÖ Saved to Cloud Successfully!");
            refreshUI();
        })
        .catch(err => {
            document.getElementById('loadingOverlay').style.display = 'none';
            alert("‚ùå Save Failed: " + err);
        });
    }

    function refreshUI() {
        renderManageSubCats();
        toggleCategoryLogic();
        renderTable();
    }

    // --- UI LOGIC ---
    function saveTheme() {
        localStorage.setItem('jijaTheme', document.getElementById('themeSelect').value);
        alert("Theme saved! Customers will see this theme.");
    }

    function renderManageSubCats() {
        const main = document.getElementById('manageCatSelect').value;
        const list = appData.subCategories[main] || [];
        document.getElementById('manageSubCatList').innerHTML = list.map(c => 
            `<span style="background:#e0e0e0; padding:5px 10px; border-radius:15px; font-size:12px;">${c} <span onclick="removeSubCat('${main}','${c}')" style="color:red; cursor:pointer; margin-left:5px; font-weight:bold;">&times;</span></span>`
        ).join('');
        if(document.getElementById('pCat').value === main) updateProductSubCatDropdown(main);
    }

    function addSubCategory() {
        const main = document.getElementById('manageCatSelect').value;
        const txt = document.getElementById('newSubCat').value;
        if(txt) {
            if(!appData.subCategories[main]) appData.subCategories[main] = [];
            appData.subCategories[main].push(txt);
            document.getElementById('newSubCat').value="";
            saveToCloud();
        }
    }

    function removeSubCat(main, sub) {
        if(confirm("Delete sub-category " + sub + "?")) {
            appData.subCategories[main] = appData.subCategories[main].filter(c => c !== sub);
            saveToCloud();
        }
    }

    function updateProductSubCatDropdown(mainCat) {
        const list = appData.subCategories[mainCat] || [];
        document.getElementById('pSubCat').innerHTML = '<option value="">Select Sub-Type</option>' + list.map(c=>`<option value="${c}">${c}</option>`).join('');
    }

    function toggleCategoryLogic() {
        const cat = document.getElementById('pCat').value;
        updateProductSubCatDropdown(cat);
        const complexCats = ['cloth', 'kids', 'jewelry', 'footwear'];
        if(complexCats.includes(cat)) {
            document.getElementById('stockSection').style.display = 'block';
            document.getElementById('simpleStockOption').style.display = 'none';
            renderStockInputs(cat);
        } else {
            document.getElementById('stockSection').style.display = 'none';
            document.getElementById('simpleStockOption').style.display = 'block';
        }
    }

    function renderStockInputs(cat) {
        if(!cat) cat = document.getElementById('pCat').value;
        const subCat = document.getElementById('pSubCat').value.toLowerCase();
        const container = document.getElementById('stockContainer');
        container.innerHTML = "";
        
        let sizes = [];
        if (cat === 'footwear') sizes = FOOTWEAR_SIZES;
        else if (cat === 'kids') sizes = KIDS_SIZES;
        else if (cat === 'jewelry' && subCat.includes('bangle')) sizes = BANGLE_SIZES;
        else if (cat === 'jewelry') sizes = ["Free Size"];
        else if (cat === 'cloth') sizes = ADULT_SIZES;
        else sizes = ["General"];

        sizes.forEach(size => {
            container.innerHTML += `<div class="stock-item"><label>${size}</label><input type="number" class="size-input" data-label="${size}" placeholder="0"></div>`;
        });
    }

    function handleFormSubmit() {
        const name = document.getElementById('pName').value;
        const price = document.getElementById('pPrice').value;
        if(!name || !price) return alert("Product Name and Price are required.");

        const cat = document.getElementById('pCat').value;
        let stockData = {};
        
        if(document.getElementById('stockSection').style.display !== 'none') {
            document.querySelectorAll('.size-input').forEach(inp => {
                stockData[inp.getAttribute('data-label')] = parseInt(inp.value) || 0;
            });
        } else {
            stockData["General"] = parseInt(document.getElementById('pSimpleStock').value) || 0;
        }

        const productObj = {
            id: editingId ? editingId : Date.now(),
            name: name,
            price: price,
            mrp: document.getElementById('pMRP').value,
            cat: cat,
            subCat: document.getElementById('pSubCat').value,
            img: document.getElementById('pImg').value || "https://via.placeholder.com/150",
            img2: document.getElementById('pImg2').value,
            img3: document.getElementById('pImg3').value,
            video: document.getElementById('pVideo').value,
            desc: document.getElementById('pDesc').value,
            isBanner: document.getElementById('pBanner').checked,
            stock: stockData
        };

        if(editingId) {
            const index = appData.products.findIndex(p => p.id === editingId);
            appData.products[index] = productObj;
        } else {
            appData.products.push(productObj);
        }
        
        saveToCloud();
        exitEditMode();
    }

    function editProduct(id) {
        const p = appData.products.find(prod => prod.id === id);
        if(!p) return;
        editingId = id;
        
        document.getElementById('productFormCard').scrollIntoView({ behavior: 'smooth' });
        document.getElementById('productFormCard').classList.add('edit-active');
        document.getElementById('formTitle').innerText = "‚úèÔ∏è Edit Product";
        document.getElementById('submitBtn').innerText = "Update Product";
        document.getElementById('cancelEditBtn').style.display = "block";

        document.getElementById('pName').value = p.name;
        document.getElementById('pPrice').value = p.price;
        document.getElementById('pMRP').value = p.mrp || "";
        document.getElementById('pCat').value = p.cat;
        document.getElementById('pImg').value = p.img;
        document.getElementById('pImg2').value = p.img2 || "";
        document.getElementById('pImg3').value = p.img3 || "";
        document.getElementById('pVideo').value = p.video || "";
        document.getElementById('pDesc').value = p.desc || "";
        document.getElementById('pBanner').checked = p.isBanner || false;

        toggleCategoryLogic();
        document.getElementById('pSubCat').value = p.subCat;
        renderStockInputs(p.cat);

        setTimeout(() => {
            if(document.getElementById('stockSection').style.display !== 'none') {
                document.querySelectorAll('.size-input').forEach(inp => {
                    const label = inp.getAttribute('data-label');
                    if(p.stock[label] !== undefined) inp.value = p.stock[label];
                });
            } else {
                document.getElementById('pSimpleStock').value = p.stock["General"];
            }
        }, 50);
    }

    function exitEditMode() {
        editingId = null;
        document.getElementById('productFormCard').classList.remove('edit-active');
        document.getElementById('formTitle').innerText = "‚ûï Add New Product";
        document.getElementById('submitBtn').innerText = "Save Product to Cloud";
        document.getElementById('cancelEditBtn').style.display = "none";
        
        document.getElementById('pName').value=""; document.getElementById('pPrice').value=""; document.getElementById('pMRP').value="";
        document.getElementById('pImg').value=""; document.getElementById('pImg2').value=""; document.getElementById('pImg3').value=""; 
        document.getElementById('pVideo').value=""; document.getElementById('pDesc').value=""; document.getElementById('pBanner').checked=false;
        document.querySelectorAll('input[type=number]').forEach(i => i.value="");
    }

    function deleteProduct(id) {
        if(confirm("Are you sure you want to delete this product?")) {
            appData.products = appData.products.filter(p => p.id !== id);
            saveToCloud();
        }
    }

    function renderTable() {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = "";
        
        if(appData.products.length === 0) {
            tbody.innerHTML = "<tr><td colspan='5' style='text-align:center; padding:20px;'>No products found. Add one above!</td></tr>";
            return;
        }

        // Show newest first
        appData.products.slice().reverse().forEach(p => {
            const bannerBadge = p.isBanner ? '<span class="badge badge-banner">Banner</span>' : '';
            
            let stockDisplay = "";
            for(const [key, qty] of Object.entries(p.stock)) {
                const badgeClass = qty > 0 ? 'badge-stock' : 'badge-zero';
                stockDisplay += `<span class="badge ${badgeClass}">${key}: ${qty}</span>`;
            }

            tbody.innerHTML += `
            <tr>
                <td><img src="${p.img}" class="img-preview" onerror="this.src='https://via.placeholder.com/50'"></td>
                <td>
                    <strong>${p.name}</strong> ${bannerBadge}<br>
                    <small style="color:#777;">${p.cat} > ${p.subCat}</small>
                </td>
                <td>
                    <div style="font-weight:bold;">‚Çπ${p.price}</div>
                    <div style="text-decoration:line-through; font-size:0.8rem; color:#999;">‚Çπ${p.mrp||'-'}</div>
                </td>
                <td><div style="max-width:300px; line-height:1.5;">${stockDisplay}</div></td>
                <td>
                    <button class="btn-edit" onclick="editProduct(${p.id})">Edit</button>
                    <button class="btn-del" onclick="deleteProduct(${p.id})">Delete</button>
                </td>
            </tr>`;
        });
    }

    function clearAllData() {
        if(confirm("‚ö†Ô∏è DANGER: This will delete ALL products from the Cloud. Are you sure?")) {
            appData = { products: [], subCategories: appData.subCategories };
            saveToCloud();
        }
    }
</script>
</body>
</html>
